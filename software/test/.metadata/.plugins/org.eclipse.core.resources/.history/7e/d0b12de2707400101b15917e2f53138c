#include "motor.h"

/* MOTOR INIT */
void motor_init(struct motor *self){

	self->_motorDirection = NONE;
}

/* MOTOR RAMP UP */
void motor_ramp_up(struct motor *self){

	/* Set starting duty cycle */
	pwm_init(self->_dutyCycle = 0, PWM_FREQUENCY_KHZ * 1000);

	/* Calculate ramp slope */
	int a = MAX_DUTY_CYCLE / RAMP_UP_STEPS_NUMBER;

	/* Begin ramp */
	for (uint8_t i = 0; i < RAMP_UP_STEPS_NUMBER; ++i ){

		/* Set duty cycle */
		pwm_set_duty_cycle(self->_dutyCycle += a * i);
		delay(RAMP_UP_STEP_LENGTH);
	}
}

/* MOTOR RAMP DOWN */
void motor_ramp_down(struct motor *self){

}

/* MOTOR RUN */
void motor_run(struct motor *self){

	/* Run motor */
	self->_motorDirection = RIGHT;

	/* RAMP UP */
	motor_ramp_up(self);
}
